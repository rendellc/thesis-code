settings:
  pdfdir: /home/cale/thesis/mainmatter/fig
  rawdir: ../figs/raw
  datadir: ../data
  onlyrun: steering_smc
experiments:
  steering_smc:
    experimenter: run_commands
    plotter: make_bag_plots
    options:
      commands:
        - "ros2 launch launch/base.launch.py bag:=true rviz:=false"
        - "ros2 launch control report_wheel_controllers.launch.py"
        - "ros2 launch simulator simulator.launch.py gui:=false"
        - "ros2 launch operation report_wheel_step.launch.py"
      monitor: TimeLimit20SecMonitor
      bagsaver_config: launch/bagsaver.yaml
      rerun: true
      bag:
        file: ../bags/step_smc.db3
        force: true
        rate: 50
      plots:
        error_fl:
          type: timeseries
          legend: true
          ylabel: "[deg]"
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: error.steering_angle
              label: fl
              scale: rad2deg

  wheel_state_errors:
    experimenter: run_commands
    plotter: make_bag_plots
    options:
      # command: "ros2 launch launch/low_curvature.launch.py use_single_turn:=true gui:=false"
      commands:
        - "ros2 launch launch/base.launch.py bag:=true rviz:=false"
        - "ros2 launch control controllers_lowcurvature.launch.py"
        - "ros2 launch simulator simulator.launch.py gui:=false"
        - "ros2 launch operation report_waypoints_simple_lap.launch.py"
      monitor: SimpleLapMonitor
      bagsaver_config: launch/bagsaver.yaml
      rerun: true
      bag:
        file: ../bags/simple_lap.db3
        force: true
        rate: 50
      plots:
        trajectory:
          type: xy
          legend: false
          xlabel: "E [m]"
          ylabel: "N [m]"
          xdata:
            topic: /vehicle/pose
            attribute: pose.position.x
          ydata:
            topic: /vehicle/pose
            attribute: pose.position.y
        steering_angle_error:
          type: timeseries
          legend: true
          ylabel: "[deg]"
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: error.steering_angle
              label: fl
              scale: rad2deg
            - topic: /vehicle/wheel_rl/controller_info
              attribute: error.steering_angle
              label: rl
              scale: rad2deg
            - topic: /vehicle/wheel_rr/controller_info
              attribute: error.steering_angle
              label: rr
              scale: rad2deg
            - topic: /vehicle/wheel_fr/controller_info
              attribute: error.steering_angle
              label: fr
              scale: rad2deg
        angular_velocity_error:
          type: timeseries
          legend: true
          ylabel: "[deg/s]"
          ylim:
            - -25
            - 25
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: error.angular_velocity
              label: fl
              scale: rad2deg
            - topic: /vehicle/wheel_rl/controller_info
              attribute: error.angular_velocity
              label: rl
              scale: rad2deg
            - topic: /vehicle/wheel_rr/controller_info
              attribute: error.angular_velocity
              label: rr
              scale: rad2deg
            - topic: /vehicle/wheel_fr/controller_info
              attribute: error.angular_velocity
              label: fr
              scale: rad2deg
  sliding_mode_results:
    experimenter: run_commands
    plotter: make_bag_plots
    options:
      #command: "ros2 launch launch/all.launch.py use_survey:=true gui:=false"
      commands:
        - "ros2 launch launch/base.launch.py bag:=true rviz:=false"
        - "ros2 launch control controllers.launch.py"
        - "ros2 launch simulator simulator.launch.py gui:=false"
        - "ros2 launch operation report_waypoints_simple_lap.launch.py"
      monitor: SimpleLapMonitor
      # Support multiple commands here. Then we dont need to put everything into a single launch file
      bagsaver_config: launch/bagsaver.yaml
      bag:
        file: ../bags/simple_lap_smc.db3
        force: true
        rate: 50
      plots:
        steering_angle_error:
          type: timeseries
          ylabel: "[deg]"
          ylim:
            - -30
            - 30
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: error.steering_angle
              label: fl
              scale: rad2deg
        steering_angle_rate:
          type: timeseries
          ylabel: "[deg/s]"
          ylim:
            - -180
            - 180
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: state.steering_angle_rate
              label: fl
              scale: rad2deg
        steering_torque:
          type: timeseries
          ylabel: "[Nm]"
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: steer_torque
              label: fl
        steering_torque_straight:
          type: timeseries
          ylabel: "[Nm]"
          xlim:
            - 35
            - 55
          ylim:
            - -100
            - 100
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: steer_torque
              label: fl
  robust_rate_results:
    plotter: make_bag_plots
    experimenter: run_commands
    options:
      commands:
        - "ros2 launch launch/base.launch.py bag:=true rviz:=false"
        - "ros2 launch control controllers.launch.py"
        - "ros2 launch simulator simulator.launch.py gui:=false"
        - "ros2 launch operation report_waypoints_simple_lap.launch.py"
      monitor: SimpleLapMonitor
      bagsaver_config: launch/bagsaver.yaml
      bag:
        file: ../bags/simplelap_robust_rate.db3
        force: true
        rate: 50
      plots:
        steering_angle_error:
          type: timeseries
          ylabel: "[deg]"
          ylim:
            - -30
            - 30
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: error.steering_angle
              label: fl
              scale: rad2deg
        steering_angle_rate:
          type: timeseries
          ylabel: "[deg/s]"
          ylim:
            - -180
            - 180
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: state.steering_angle_rate
              label: fl
              scale: rad2deg
        steering_torque:
          type: timeseries
          ylabel: "[Nm]"
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: steer_torque
              label: fl
        steering_torque_straight:
          type: timeseries
          ylabel: "[Nm]"
          xlim:
            - 35
            - 55
          ylim:
            - -100
            - 100
          datas:
            - topic: /vehicle/wheel_fl/controller_info
              attribute: steer_torque
              label: fl
  vehicle_state_errors:
    plotter: make_bag_plots
    options:
      bagsaver_config: launch/bagsaver.yaml
      bag:
        file: ../bags/simple_lap.db3
        force: true
        rate: 50
      plots:
        yaw_error:
          type: timeseries
          ylabel: "[deg]"
          datas:
            - topic: /vehicle/controller_info
              attribute: yaw_error
              label: "$\\tilde\\psi$"
              scale: rad2deg
        cross_track_error:
          type: timeseries
          ylabel: "[cm]"
          datas:
            - topic: /vehicle/controller_info
              attribute: cross_track_error
              label: "$e_c$"
              scale: 100.0
        # vehicle_speed_error:
        #   type: timeseries
        # xlabel: "time [s]"
        # ylabel: "$\\tilde\\delta_w$ [deg]"
  fermat_line:
    #command: python3 launch/make_path_plots.py
    plotter: make_path_plots
    #- ./../build/pathlib_testing
    options:
      num-samples: 100
      waypoints:
        - 1,1
        - 3,4
        - 10,5
        - 18,3
        - 18,10
      smoothing: line
      curvatures:
        - 1.0
  circular_smoothing:
    #command: python3 launch/make_path_plots.py
    plotter: make_path_plots
    #- ./../build/pathlib_testing
    options:
      num-samples: 100
      waypoints:
        - 1,1
        - 3,4
        - 10,5
        - 18,3
        - 18,10
      smoothing: circle
      curvatures:
        - 0.4
  fermat_smoothing_curvature:
    #command: python3 launch/make_path_plots.py
    plotter: make_path_plots
    #- ./../build/pathlib_testing
    options:
      num-samples: 100
      waypoints:
        - 1,1
        - 3,4
        - 10,5
        - 18,3
        - 18,10
      smoothing: fermat
      curvatures:
        - 0.5
  fermat_smoothing_curvatures:
    #command: python3 launch/make_path_plots.py
    plotter: make_path_plots
    #- ./../build/pathlib_testing
    options:
      num-samples: 100
      waypoints:
        - 1,1
        - 3,4
        - 10,5
        - 18,3
        - 18,10
      smoothing: fermat
      curvatures:
        - 0.5
        - 1.0
        - 2.0
      labels:
        - "$\\kappa_{max} = 0.5$"
        - "$\\kappa_{max} = 1.0$"
        - "$\\kappa_{max} = 2.0$"
  fermat_smoothing_invalid:
    plotter: make_path_plots
    options:
      num-samples: 100
      waypoints:
        - 0,0
        - 5,0
        - 5,5
        - 10,5
      smoothing: fermat
      curvatures:
        - 0.4
  fermat_vs_circle:
    plotter: make_path_plots
    options:
      num-samples: 100
      waypoints:
        - 0,0
        - 5,0
        - 4,5
      smoothings:
        - line
        - fermat
        - circle
      curvatures:
        - 0.5
      labels:
        - line
        - circle
        - fermat

  chattering_smc_vs_rr:
    plotter: chattering_comparison
    options:
      figs:
        - "../figs/raw/sliding_mode_results/steering_torque.fig"
        - "../figs/raw/robust_rate_results/steering_torque.fig"
      labels:
        - SMC
        - RR
      tlim:
        - 60
        - 75
      alpha: 0.5
